helm upgrade --install nginx ingress-nginx/ingress-nginx --namespace otus -f ./nginx_ingress.yaml

kubectl create secret generic postgresql-db-pass --from-literal=password='vdOX2We5DCSpeGo9' --from-literal=postgres-password='xcNftqO2Q2THMv6C'

helm install postgresql oci://registry-1.docker.io/bitnamicharts/postgresql -f postgresql-values.yaml

helm upgrade --install backend-app ./backend-app

minikube tunnel

newman run otus_user_pm_collection.json


Grafana:
helm repo add prometheus-community https://prometheus-community.github.io/helm-charts
helm repo update
helm install prom-stack prometheus-community/kube-prometheus-stack -f prom/prometheus.yaml

kubectl port-forward svc/prom-stack-grafana 9000:80

Metrics:
1. Latency (with Percentiles)
sum(rate(http_server_requests_seconds_bucket{ status=~"2..", uri=~"/user/.*"}[1m])) by (le))
2. RPS
sum by(method, uri) (rate(http_server_requests_seconds_count{container="backend-app", uri=~"/user/.*"}[1m]))
3. Error rate
sum by(pod) (idelta(http_server_requests_seconds_count{container="backend-app", uri=~"/user/.*", status=~"5.."}[1m]))

Ingress:
nginx_ingress_controller_requests (TODO)